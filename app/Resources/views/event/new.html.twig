{% extends 'commonSideTemplate.html.twig' %}

{% block main_container %}
    <div class="block">
        <h2>New Event</h2>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    {{ form_start(form) }}
                    {{ form_widget(form) }}
                    {{ form_end(form) }}
                </div>
                <div class="col-sm-6">
                    <div id="googleMap" style="width:500px;height:380px;"></div>
                    <p class="text-center">Click on the map to select place</p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="http://maps.googleapis.com/maps/api/js"></script>
    <script>

        var map;
        var geocoder;
        var mapOptions = {center: new google.maps.LatLng(0.0, 0.0), zoom: 2,
            mapTypeId: google.maps.MapTypeId.ROADMAP};

        function initialize() {
            var myOptions = {
                center: new google.maps.LatLng(52, 20),
                zoom: 6,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            geocoder = new google.maps.Geocoder();
            var map = new google.maps.Map(document.getElementById("googleMap"), myOptions);
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(event.latLng);
            });

            var marker;
            function placeMarker(location) {
                if (marker) {
                    marker.setPosition(location);
                } else {
                    marker = new google.maps.Marker({
                        position: location,
                        map: map
                    });
                }
                $("#form_latitude").val(location.lat());
                $("#form_longitude").val(location.lng());
                getAddress(location);
            }

            function getAddress(latLng) {
                geocoder.geocode({'latLng': latLng},
                function (results, status) {
                    var addressToShow;
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            addressToShow = results[0].formatted_address;
                        }
                        else {
                            addressToShow = "No results";
                        }
                    }
                    else {
                        addressToShow = status;
                    }
                    $("#form_address").val(addressToShow);
                });
            }
        }
        google.maps.event.addDomListener(window, 'load', initialize);



    </script>
{% endblock %}